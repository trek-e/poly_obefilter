---
phase: 05-cutoff-control
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/HydraQuartetVCF.cpp
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Filter starts fully open (20kHz cutoff) when module loads"
    - "Cutoff knob sweeps frequency across full audible range (20Hz-20kHz)"
    - "CV input modulates cutoff frequency with V/Oct scaling"
    - "Attenuverter at center (0) means CV has no effect"
    - "Attenuverter scales and inverts CV depth (-1 to +1)"
    - "Cutoff control responds smoothly without zipper noise"
  artifacts:
    - path: "src/HydraQuartetVCF.cpp"
      provides: "Cutoff parameter configuration with correct default"
      contains: "configParam(CUTOFF_PARAM, 0.f, 1.f, 1.f"
  key_links:
    - from: "CUTOFF_PARAM"
      to: "baseCutoffHz calculation"
      via: "getValue() -> pow(1000, param)"
      pattern: "20\\.f \\* std::pow\\(1000\\.f, cutoffParam\\)"
    - from: "CUTOFF_CV_INPUT"
      to: "cutoffHz modulation"
      via: "V/Oct exponential scaling"
      pattern: "std::pow\\(2\\.f, cutoffCV \\* cvAmount\\)"
---

<objective>
Refine cutoff frequency control default position

Purpose: The filter should start "fully open" (20kHz) so new patches produce immediate audio output. Currently defaults to mid-range (0.5 = 632 Hz) which sounds dull until user adjusts the knob.

Output: Updated configParam with default 1.0 (fully open), verified working cutoff control with existing V/Oct CV modulation and bipolar attenuverter
</objective>

<execution_context>
@/Users/trekkie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/trekkie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-cutoff-control/05-RESEARCH.md
@.planning/phases/05-cutoff-control/05-CONTEXT.md

# Source file to modify
@src/HydraQuartetVCF.cpp
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update cutoff parameter default to fully open</name>
  <files>src/HydraQuartetVCF.cpp</files>
  <action>
Change the configParam for CUTOFF_PARAM from default 0.5 to default 1.0 (fully open).

Current line 34:
```cpp
configParam(CUTOFF_PARAM, 0.f, 1.f, 0.5f, "Cutoff");
```

Change to:
```cpp
configParam(CUTOFF_PARAM, 0.f, 1.f, 1.f, "Cutoff");
```

This is the ONLY code change needed. The existing implementation already handles:
- Logarithmic frequency mapping: `20.f * std::pow(1000.f, cutoffParam)` (20Hz at 0, 20kHz at 1)
- V/Oct CV scaling: `std::pow(2.f, cutoffCV * cvAmount)` (frequency doubles per volt)
- Bipolar attenuverter: -1 to +1, defaults to 0 (no CV effect until user adjusts)
- Frequency clamping: 20Hz to 20kHz
- Parameter smoothing: 1ms tau in SVFilter.hpp prevents zipper noise

Do NOT add Hz display to tooltip - the research defers this as polish (can be added later if desired).
  </action>
  <verify>
1. `make -j4` compiles without errors
2. grep confirms the change: `grep "CUTOFF_PARAM" src/HydraQuartetVCF.cpp` shows default 1.f
  </verify>
  <done>configParam default changed from 0.5f to 1.f</done>
</task>

<task type="auto">
  <name>Task 2: Verify cutoff control behavior</name>
  <files>None (verification only)</files>
  <action>
Verify the complete cutoff control system works correctly:

1. Build the module: `make -j4`
2. Load module in VCV Rack and confirm:
   - Filter starts fully open (audio passes through at 20kHz cutoff)
   - Turning cutoff knob down sweeps from 20kHz toward 20Hz
   - Cutoff knob at 0 = 20Hz (maximum filtering)
   - Without CV connected, attenuverter position has no effect
   - With CV connected and attenuverter at center (0), CV has no effect
   - With CV connected and attenuverter at +1, positive CV raises cutoff
   - With CV connected and attenuverter at -1, positive CV lowers cutoff (inverted)
   - Fast knob sweeps produce no audible zipper noise

Document verification results in commit message.
  </action>
  <verify>
1. Module loads in VCV Rack without crash
2. Audio passes through when cutoff knob is at max (default position)
3. Cutoff responds to knob and CV as expected
  </verify>
  <done>Cutoff control verified working: fully open default, V/Oct CV modulation, bipolar attenuverter, smooth operation</done>
</task>

</tasks>

<verification>
After completing all tasks, verify phase success criteria from ROADMAP.md:

1. **Cutoff knob sweeps filter frequency across audible range**
   - Verify: Turn knob from 0 to 1, listen for frequency sweep from 20Hz to 20kHz

2. **CV input modulates cutoff frequency**
   - Verify: Connect LFO to CV input, set attenuverter to +1, hear cutoff sweep

3. **Attenuverter scales CV input range (positive and negative)**
   - Verify: At +1: positive CV raises cutoff; at -1: positive CV lowers cutoff

4. **Cutoff control responds smoothly without zipper noise**
   - Verify: Fast manual sweeps produce no audible stepping/crackling
</verification>

<success_criteria>
- Module compiles without errors
- Filter defaults to fully open (20kHz) on load
- Cutoff knob sweeps 20Hz-20kHz logarithmically
- CV modulates cutoff with V/Oct scaling
- Attenuverter at 0 = no CV effect
- Attenuverter bipolar (-1 inverts, +1 normal)
- No zipper noise during fast parameter changes
</success_criteria>

<output>
After completion, create `.planning/phases/05-cutoff-control/05-01-SUMMARY.md`
</output>
