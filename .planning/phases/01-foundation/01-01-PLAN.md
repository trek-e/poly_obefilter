---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - plugin.json
  - Makefile
  - src/plugin.cpp
  - res/HydraQuartetVCF.svg
  - src/HydraQuartetVCF.cpp
  - README.md
autonomous: false

must_haves:
  truths:
    - "Plugin compiles without errors"
    - "Plugin loads in VCV Rack library browser"
    - "Module appears with correct branding (Synth-etic Intelligence)"
    - "Panel shows all control positions (knobs, ports, sections)"
    - "Panel matches HydraQuartet VCO visual style"
    - "README contains build instructions"
  artifacts:
    - path: "plugin.json"
      provides: "Plugin manifest with metadata"
      contains: "HydraQuartetVCF"
    - path: "Makefile"
      provides: "Build configuration"
      contains: "plugin.mk"
    - path: "src/plugin.cpp"
      provides: "Plugin registration"
      exports: ["init"]
    - path: "res/HydraQuartetVCF.svg"
      provides: "Panel design with component placeholders"
      min_lines: 100
    - path: "src/HydraQuartetVCF.cpp"
      provides: "Module and widget implementation"
      exports: ["HydraQuartetVCF", "HydraQuartetVCFWidget"]
    - path: "README.md"
      provides: "Build instructions and usage documentation"
      min_lines: 30
  key_links:
    - from: "plugin.json"
      to: "src/HydraQuartetVCF.cpp"
      via: "module slug reference"
      pattern: '"slug".*"HydraQuartetVCF"'
    - from: "res/HydraQuartetVCF.svg"
      to: "src/HydraQuartetVCF.cpp"
      via: "helper.py SVG extraction"
      pattern: "createParamCentered|createInputCentered|createOutputCentered"
    - from: "Makefile"
      to: "plugin.mk"
      via: "SDK include"
      pattern: "include.*plugin\\.mk"
---

<objective>
Establish complete plugin infrastructure and panel design for HydraQuartet VCF-OB.

Purpose: Create the foundation that compiles, loads in VCV Rack, and provides visual panel design ready for DSP implementation in Phase 2.

Output: Working plugin scaffold with complete panel design, module code, and documentation. Plugin appears in VCV Rack library browser with correct branding and visual style.
</objective>

<execution_context>
@/Users/trekkie/.claude/get-shit-done/workflows/execute-plan.md
@/Users/trekkie/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Plugin Structure</name>
  <files>
    plugin.json
    Makefile
    src/plugin.cpp
  </files>
  <action>
Use VCV Rack SDK helper.py to create plugin scaffold:

1. Navigate to project directory: `/Users/trekkie/projects/vcvrack_modules/poly_obefilter`

2. Run helper.py to create plugin structure:
   ```bash
   $RACK_DIR/helper.py createplugin HydraQuartetVCF
   ```
   Note: This creates the base structure. We'll update plugin.json metadata next.

3. Update plugin.json with correct metadata:
   - slug: "Synth-eticIntelligence" (plugin slug, not module slug)
   - name: "Synth-etic Intelligence"
   - version: "2.0.0" (must be 2.x for Rack 2.x)
   - license: "GPL-3.0-or-later"
   - brand: "Synth-etic Intelligence"
   - author: "Synth-etic Intelligence"
   - authorEmail: "syntheticint@thepainterofsilence.com"
   - sourceUrl: "https://github.com/trek-e/HydraQuartetVCF"
   - modules: [] (empty for now, will be populated by Task 2)

4. Verify Makefile includes standard structure:
   ```makefile
   RACK_DIR ?= ../Rack-SDK
   SOURCES += $(wildcard src/*.cpp)
   DISTRIBUTABLES += res presets LICENSE.txt
   include $(RACK_DIR)/plugin.mk
   ```

5. Create LICENSE.txt with GPL-3.0 license text

6. Verify src/plugin.cpp has standard registration:
   ```cpp
   #include "plugin.hpp"
   Plugin* pluginInstance;
   void init(Plugin* p) {
       pluginInstance = p;
       // Models will be added here by helper.py in Task 2
   }
   ```

Context from RESEARCH.md:
- helper.py is the standard scaffolding tool (Pattern 1)
- Makefile delegates to plugin.mk (Pattern 4)
- Version must be 2.x for Rack 2.x (Common Pitfall 2)
- Slug cannot change after release (Common Pitfall 6)
</action>
  <verify>
1. `ls -la` shows: plugin.json, Makefile, src/, res/
2. `cat plugin.json` contains correct slug and version 2.x
3. `cat Makefile` includes plugin.mk
4. `ls src/` shows plugin.cpp
  </verify>
  <done>
Plugin directory structure exists with plugin.json, Makefile, src/plugin.cpp, and res/ directory. Metadata correctly configured for VCV Rack 2.x.
  </done>
</task>

<task type="auto">
  <name>Task 2: Design Panel SVG</name>
  <files>res/HydraQuartetVCF.svg</files>
  <action>
Create panel design in Inkscape matching HydraQuartet VCO visual style:

**Important:** If Inkscape is not installed, install it first (required for panel design):
- Mac: `brew install --cask inkscape`
- Or download from https://inkscape.org/

1. Decide final HP width:
   - Count components needed: Audio in (1), Cutoff knob+CV+attenuverter (3), Resonance knob+CV (2), Drive knob (1), 4 filter outputs (4) = 11 components minimum
   - Choose 14 HP for comfortable spacing: 71.12mm width
   - Document decision in plan summary

2. Create new Inkscape document:
   - File > Document Properties
   - Units: mm
   - Dimensions: 128.5mm height × 71.12mm width (14 HP)
   - No margins, no padding

3. Design panel visual style matching HydraQuartet VCO:
   - Background rectangle: #1a1a2e fill
   - Border: #3a3a5e stroke (1-2px)
   - Module title "HYDRAQUARTET VCF-OB" at top: #8888aa color, sans-serif font
   - Section labels:
     - "INPUT" section (top left area): #8888aa
     - "CUTOFF" section: soft blue accent
     - "RESONANCE" section: muted teal accent
     - "DRIVE" section: dusty brown accent
     - "OUTPUTS" section: dusty orange (#aa8866 range)
   - Divider lines between sections: #3a3a5e
   - Minimal text labels, hierarchical font sizing

4. Create "components" layer (for helper.py extraction):
   - Layer > Layers > Add Layer > Name: "components"
   - Add component placeholders:
     - Red circles (#ff0000): Parameters (knobs)
       - Cutoff knob (~30mm from top left)
       - Cutoff CV attenuverter (below cutoff knob)
       - Resonance knob (~55mm from top left)
       - Drive knob (~80mm from top left)
     - Green circles (#00ff00): Inputs
       - Audio input (top left, ~15mm from top)
       - Cutoff CV input (adjacent to cutoff knob)
       - Resonance CV input (adjacent to resonance knob)
     - Blue circles (#0000ff): Outputs (bottom section)
       - LP output (~85mm from top)
       - HP output (~95mm from top)
       - BP output (~105mm from top)
       - Notch output (~115mm from top)
   - Use medium-sized circles (standard VCV component size, ~10mm diameter placeholders)

5. Layout principles from CONTEXT.md:
   - Audio input at top left (VCV convention)
   - CV inputs adjacent to target knobs
   - Controls grouped by function
   - Outputs section at bottom, clearly labeled
   - Sections separated by dividers

6. Finalize SVG:
   - Select all text: Path > Object to Path (converts text to paths for NanoVG)
   - Hide "components" layer (click eye icon)
   - Save As: res/HydraQuartetVCF.svg

**Visual style reference:** HydraQuartet VCO at https://github.com/trek-e/HydraQuartet uses same color palette, font hierarchy, and dark industrial aesthetic. Match that style exactly.

**Critical constraints from RESEARCH.md:**
- Dimensions must be exact: 128.5mm × 71.12mm (Pattern 2, Pitfall 1)
- All text must be paths (Pitfall 3)
- Components layer must be hidden before saving (Pitfall 4)
- Color codes must be exact for helper.py: red=#ff0000, green=#00ff00, blue=#0000ff, magenta=#ff00ff (Pattern 2)
</action>
  <verify>
1. Open res/HydraQuartetVCF.svg in Inkscape
2. Document Properties shows 128.5mm × 71.12mm
3. Components layer exists and contains colored circles
4. Components layer is hidden (eye icon off)
5. All text is paths (not editable as text)
6. Visual style matches requirements (dark background #1a1a2e, title visible, sections labeled)
  </verify>
  <done>
Panel SVG exists at res/HydraQuartetVCF.svg with correct dimensions, component placeholders on hidden layer, HydraQuartet VCO visual style, and all text converted to paths.
  </done>
</task>

<task type="auto">
  <name>Task 3: Generate Module Code and Build</name>
  <files>src/HydraQuartetVCF.cpp</files>
  <action>
Use helper.py to generate module code from SVG panel, update plugin registration, and compile:

1. Generate module code from SVG:
   ```bash
   cd /Users/trekkie/projects/vcvrack_modules/poly_obefilter
   $RACK_DIR/helper.py createmodule HydraQuartetVCF res/HydraQuartetVCF.svg src/HydraQuartetVCF.cpp
   ```
   This auto-generates:
   - Module class with param/input/output enums
   - Widget class with createParamCentered/createInputCentered/createOutputCentered calls
   - Exact widget positioning from SVG component layer

2. Review generated src/HydraQuartetVCF.cpp:
   - Verify enum counts match panel (4 params, 3 inputs, 4 outputs, 0 lights)
   - Add proper configParam/configInput/configOutput calls in Module constructor:
     ```cpp
     configParam(CUTOFF_PARAM, 0.f, 1.f, 0.5f, "Cutoff");
     configParam(CUTOFF_ATTEN_PARAM, -1.f, 1.f, 0.f, "Cutoff CV");
     configParam(RESONANCE_PARAM, 0.f, 1.f, 0.f, "Resonance");
     configParam(DRIVE_PARAM, 0.f, 1.f, 0.f, "Drive");

     configInput(AUDIO_INPUT, "Audio");
     configInput(CUTOFF_CV_INPUT, "Cutoff CV");
     configInput(RESONANCE_CV_INPUT, "Resonance CV");

     configOutput(LP_OUTPUT, "Lowpass");
     configOutput(HP_OUTPUT, "Highpass");
     configOutput(BP_OUTPUT, "Bandpass");
     configOutput(NOTCH_OUTPUT, "Notch");
     ```
   - Stub process() method (no DSP yet, Phase 2):
     ```cpp
     void process(const ProcessArgs& args) override {
         // DSP implementation in Phase 2
     }
     ```

3. Update plugin.json modules array:
   ```json
   "modules": [
     {
       "slug": "HydraQuartetVCF",
       "name": "HydraQuartet VCF-OB",
       "description": "8-voice Oberheim-style multimode filter",
       "tags": ["Filter", "Polyphonic", "VCF", "Multimode"]
     }
   ]
   ```

4. Update src/plugin.cpp to register model:
   - Add to end of file (helper.py may do this automatically):
     ```cpp
     Model* modelHydraQuartetVCF = createModel<HydraQuartetVCF, HydraQuartetVCFWidget>("HydraQuartetVCF");
     ```
   - Update init() function:
     ```cpp
     void init(Plugin* p) {
         pluginInstance = p;
         p->addModel(modelHydraQuartetVCF);
     }
     ```

5. Compile plugin:
   ```bash
   make clean
   make
   ```
   This produces dist/HydraQuartetVCF.vcvplugin

6. If compilation fails:
   - Check RACK_DIR environment variable: `echo $RACK_DIR`
   - Verify SDK installation
   - Check error messages for missing includes or syntax errors

Context from RESEARCH.md:
- helper.py createmodule extracts widget positions from SVG (Pattern 2)
- Module class structure follows Pattern 5
- Standard compilation uses `make` (Pattern 4)
- Common pitfall: RACK_DIR not set (Pitfall 5)
</action>
  <verify>
1. `ls src/` shows HydraQuartetVCF.cpp
2. `grep -c "createParamCentered" src/HydraQuartetVCF.cpp` returns 4 (4 params)
3. `grep -c "createInputCentered" src/HydraQuartetVCF.cpp` returns 3 (3 inputs)
4. `grep -c "createOutputCentered" src/HydraQuartetVCF.cpp` returns 4 (4 outputs)
5. `cat plugin.json` shows HydraQuartetVCF in modules array
6. `make` completes without errors
7. `ls dist/` shows .vcvplugin file
  </verify>
  <done>
Module code exists at src/HydraQuartetVCF.cpp with widget positioning from SVG, plugin.json references module, plugin compiles successfully to .vcvplugin file.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Documentation</name>
  <files>README.md</files>
  <action>
Create comprehensive README.md covering build instructions and usage:

1. Create README.md with the following sections:

**Header:**
```markdown
# HydraQuartet VCF-OB

8-voice polyphonic Oberheim-style multimode filter for VCV Rack 2.x

By Synth-etic Intelligence
```

**Description section:**
- Explain what the module does (Oberheim-style filter, 12dB SEM-style character)
- List features: 8-voice polyphonic, multimode (LP/HP/BP/Notch), CV control
- Mention it's part of HydraQuartet series

**Building from Source section:**
- Prerequisites: VCV Rack SDK 2.x, Make, Inkscape (for panel editing)
- Mac-specific dependencies via Homebrew
- Clone repository
- Set RACK_DIR environment variable
- Run `make` to build
- Run `make install` to install to Rack plugins folder
- Include troubleshooting tip for RACK_DIR not set error

**Usage section:**
- Audio input (top left): Connect audio source
- Cutoff control: Knob + CV input + attenuverter
- Resonance control: Knob + CV input
- Drive control: Adds saturation character
- Filter outputs: LP, HP, BP, Notch (simultaneous operation)
- Polyphonic operation: Supports 1-8 channels

**Current Status section:**
- Version 0.5.0 (beta)
- Phase 1: Foundation complete (this phase)
- Phase 2: DSP implementation in progress
- Link to GitHub issues for bug reports

**License section:**
- GPL-3.0-or-later
- Component library (VCV Rack) is CC BY-NC 4.0

**Credits section:**
- Inspired by classic Oberheim SEM and OB-X filters
- Built with VCV Rack SDK

2. Follow standard Markdown formatting:
   - Use headers (##) for sections
   - Code blocks for commands
   - Bullet lists for features and steps
   - Links to GitHub repository and VCV Rack site

3. Keep tone technical but accessible:
   - Assume reader knows VCV Rack basics
   - Provide enough detail for first-time builders
   - Reference RESEARCH.md patterns where helpful

Context from CONTEXT.md:
- Manual URL should point to GitHub README
- Version 0.5.0 corresponds to v0.50b milestone (Phase 1)
- GPL-3.0 license matching HydraQuartet VCO
</action>
  <verify>
1. `cat README.md` shows all required sections
2. `grep -i "build" README.md` contains build instructions
3. `grep -i "usage\|controls" README.md` describes module operation
4. `grep "GPL-3.0" README.md` shows license
5. Word count > 300 words (comprehensive documentation)
  </verify>
  <done>
README.md exists with complete build instructions, usage documentation, prerequisites, and project information.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete plugin infrastructure:
- Plugin scaffold with plugin.json, Makefile, source files
- Panel design (HydraQuartetVCF.svg) matching HydraQuartet VCO visual style
- Module code with widget positioning from SVG
- Compiled plugin (.vcvplugin file)
- README documentation
  </what-built>
  <how-to-verify>
**Visual Verification:**

1. Open res/HydraQuartetVCF.svg in Inkscape:
   - Document dimensions: 128.5mm × 71.12mm
   - Visual style matches HydraQuartet VCO (dark background #1a1a2e, dusty orange outputs section)
   - All sections labeled (Input, Cutoff, Resonance, Drive, Outputs)
   - Component positions look reasonable (audio input top left, outputs bottom)
   - Panel feels cohesive with VCO design (same color palette, font style, dividers)

2. Verify components layer (make visible in Layers panel):
   - Red circles for 4 params (cutoff, cutoff atten, resonance, drive)
   - Green circles for 3 inputs (audio, cutoff CV, resonance CV)
   - Blue circles for 4 outputs (LP, HP, BP, Notch)
   - All circles positioned on correct visual elements

**Functional Verification:**

3. Install plugin to VCV Rack:
   ```bash
   cd /Users/trekkie/projects/vcvrack_modules/poly_obefilter
   make install
   ```

4. Open VCV Rack:
   - Right-click empty space > Browse Library
   - Search "Synth-etic Intelligence"
   - HydraQuartet VCF-OB should appear in browser
   - Drag module to rack

5. Verify in VCV Rack:
   - Panel renders correctly (visual style matches design)
   - Module title "HYDRAQUARTET VCF-OB" visible
   - All knobs and ports appear at correct positions
   - Sections clearly labeled (Output section with 4 ports)
   - No visual artifacts (text should be crisp, not black rectangles)
   - Module doesn't crash Rack on load

6. Quick interaction test (no audio expected yet):
   - Click and drag knobs (should move smoothly)
   - Hover over inputs/outputs (tooltips show correct names: "Cutoff", "Audio", "Lowpass", etc.)
   - Module takes space correctly, aligns with adjacent modules

**Documentation Verification:**

7. Review README.md:
   - Build instructions clear and complete
   - Usage section describes all controls
   - Prerequisites listed
   - License information present

**Expected Issues (NOT failures):**
- No audio output (DSP implementation is Phase 2)
- Process() method is stubbed
- No actual filtering happens yet

**Approval criteria:**
- Panel design matches HydraQuartet VCO visual style
- Plugin compiles and loads without crashes
- All components positioned correctly
- Documentation is complete
  </how-to-verify>
  <resume-signal>
Type "approved" if all verifications pass, or describe specific issues found (visual misalignment, missing components, compilation errors, etc.)
  </resume-signal>
</task>

</tasks>

<verification>
Phase 1 complete when all must_haves are satisfied:

**Build Verification:**
- [ ] `make` completes without errors
- [ ] dist/*.vcvplugin file exists
- [ ] `make install` succeeds

**Runtime Verification:**
- [ ] Plugin appears in VCV Rack library browser under "Synth-etic Intelligence"
- [ ] Module loads without crashing Rack
- [ ] Panel renders with correct visual style

**Code Verification:**
- [ ] plugin.json contains HydraQuartetVCF module entry with correct tags
- [ ] src/HydraQuartetVCF.cpp has configParam/configInput/configOutput calls
- [ ] Widget positioning code matches SVG component positions

**Documentation Verification:**
- [ ] README.md exists with build instructions
- [ ] README.md describes module usage
- [ ] LICENSE.txt contains GPL-3.0 license

**Visual Verification:**
- [ ] Panel matches HydraQuartet VCO style (colors, fonts, layout)
- [ ] All control positions marked and functional
- [ ] Sections clearly labeled
</verification>

<success_criteria>
1. Plugin compiles successfully using `make` without errors
2. Plugin loads in VCV Rack 2.x without crashes
3. Module appears in library browser with "Synth-etic Intelligence" branding
4. Panel renders with all 11 components (4 knobs, 3 inputs, 4 outputs)
5. Panel visual style matches HydraQuartet VCO exactly (color palette, fonts, layout)
6. README contains complete build instructions and usage documentation
7. All files committed to git with foundation complete

**Measurable outcomes:**
- `make` exit code 0
- VCV Rack library search "Synth-etic Intelligence" returns 1 result
- Module panel height = 128.5mm, width = 71.12mm
- Panel contains sections: Input, Cutoff, Resonance, Drive, Outputs
- README word count > 300 words
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` using the summary template.

Document in summary:
- Final HP width decision (14 HP)
- Panel layout choices and visual style implementation
- Component positioning from SVG extraction
- Build environment setup (RACK_DIR, dependencies)
- Any deviations from standard helper.py workflow
- Verification results from checkpoint
</output>
